
RT = 3 days
AT = 3 hours

// Order of execution
// Initial render by root layout (Update AT & sessionState) => Any protected routes

// sessionState {userName, cart, lang}
// Root layout updates sessionState immediately during the initial render.
// After initial render, sessionState will last as long as the session lasts.
// In case of very long session (> 3 hours), AT can expired first.

// Guest
// No RT means this user is a guest.
// Guest is immediately redirected on any protected routes.

// CASE 1 : (!rt) => Guest. Redirect immediately.
// CASE 2-1 : (rt&&!at) => AT from initial render has expired due to very long session.
// CASE 2-2 : (rt&&at) => AT from initial render is still alive in this session.


//Protected routes
// account/items
// account/orders
// account/security
// account/settings
// account/wishlist

//Wishlist
// A wishlist can hold 20 items max.
// A user can have 5 wishlists max.
// Each wishlist can be renamed. 
// Each wishlist can be navigated by /account/wishlist/my-wishlist
// Search operation in the user browser and not in the database.
// Join wishlist table and product table for a complete wishlist data.
// list_data column in the wishlist table is JSONB.


// Protected route behaviour
// What we want :
// As soon as the AT disappears from the cookie, we want to either use RT or redirect.
// In an edge case, a user can hover over a link (prefetch), wait 3 hours and navigate to that same link. 
// Here, we want the AT check to happen at the time of navigation. Prefetch is irrelevant.




The advantage of useVisibleTask
// We can trigger the AT check on navigation.

// useTask behaviour
// useTask in the layout DOES NOT RUN on every navigation, if the navigation is within the layout's route.
// e.g. navigating '/account/' => '/account/items' does not trigger useTask.
// To make sure that the above navigation triggers useTask, useTask has to be declared on each route.


// Strange reload behaviour
// Prefetch won't happen on the route that reload was performed.
// e.g. If page-reload was perfomed on /a/ , hovering over on /a/ from /b/ won't trigger a prefetch.








